.container
  .row.task-index-header
    %h1
      Care tasks for
      =best_in_place @group, :name
      %span.edit-indicator.glyphicon.glyphicon-pencil
    =link_to new_group_task_path(current_user.group) do
      .purple-new-task-button
        %h4 Add New Task
  .row
    %ul.nav.nav-tabs
      %li
        %a.my-task-count{'data-toggle' => "tab", href: "#mytasks"}
          My Tasks
          ="(#{@my_tasks.count})"
      %li
        %a{'data-toggle' => "tab", href: "#alltasks"}
          All Upcoming Tasks
          ="(#{@tasks.count})"
      %li
        %a.open-task-count{'data-toggle' => "tab", href: "#opentasks"}
          Open Tasks
          ="(#{@open_tasks.count})"

    .tab-content
      #mytasks.tab-pane.fade
        -unless @my_tasks.empty?
          -@my_tasks.sort_by(&:task_date).each do |task|
            =render 'task', task: task, group: @group
        -else
          =render 'tasks/no_tasks'

      #alltasks.tab-pane.fade
        -@tasks.sort_by(&:task_date).each do |task|
          =render 'all_task', task: task, group: @group

      #opentasks.tab-pane.fade
        -unless @open_tasks.empty?
          -@open_tasks.sort_by(&:task_date).each do |task|
            =render 'all_task', task: task, group: @group
        -else
          =image_tag("#{random_photo}", class: 'random-photo')
          =render 'tasks/no_group_tasks'

#first-time-user.modal.fade
  .modal-dialog
    .modal-content
      .modal-header
        %button.close{"aria-hidden" => "true", "data-dismiss" => "modal", type: "button"}X
        %h1 Hello, First-Timer!
      .modal-body
        %h4 This is a sweet CareWell modal! 
      .modal-footer
        %button.btn.btn-default{"data-dismiss" => "modal", type: "button"} Close

:javascript
  $(document).ready(function () {
    

    //first time user
    if (#{current_user.sign_in_count} == 1) {
      // check if the modal has been viewed this session
      if (getCookie("welcomeModalViewed") === "") {  
        $('#first-time-user').modal('show');   // show the modal
        document.cookie = "welcomeModalViewed=true";  // set a cookie
      }
    }

    $('dismiss').on('click', function() {
      $('first-time-user').hide();
    });

    //second-time user

    if (#{@my_tasks.count} < 1) {
      $('.nav-tabs li:last').addClass('active');
      $('#opentasks').addClass('in active');
    }
    else {
      $('.nav-tabs li:first').addClass('active');
      $('#mytasks').addClass('in active');
    }
  });


  // Cookie Functions
  // This gets the value of a cookie
  function getCookie(cookiename) {
    var name = cookiename + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
      var c = ca[i].trim();
      if (c.indexOf(name)==0) return c.substring(name.length,c.length);
    }
    return "";
  }